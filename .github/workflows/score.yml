# name: Score Submission

# # Trigger on pull request changes in submissions folder
# on:
#   pull_request:
#     paths:
#       - 'submissions/*.csv'

# jobs:
#   score:
#     runs-on: ubuntu-latest

#     steps:
#     # 1. Checkout the repo
#     - name: Checkout repository
#       uses: actions/checkout@v3

#     # 2. Setup Python
#     - name: Set up Python
#       uses: actions/setup-python@v4
#       with:
#         python-version: '3.10'

#     # 3. Install dependencies
#     - name: Install dependencies
#       run: |
#         pip install --upgrade pip
#         pip install -r requirements.txt

#     # 4. Identify the submission file
#     - name: Identify submission CSV
#       run: |
#         echo "PR_SUBMISSION=$(basename $GITHUB_EVENT_PATH)" >> $GITHUB_ENV

#     # 5. Run scoring
#     - name: Run scoring script
#       run: |
#         python scoring_script.py submissions/$PR_SUBMISSION

#     # 6. Update leaderboard (optional)
#     - name: Update leaderboard
#       run: |
#         python update_leaderboard.py

# name: Score Submission

# on:
#   pull_request:
#     paths:
#       - 'submissions/*.csv'

# jobs:
#   score:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v3

#       - name: Set up Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: 3.10

#       - name: Install dependencies
#         run: |
#           pip install --upgrade pip
#           pip install -r requirements.txt

#       - name: Run scoring
#         run: |
#           python evaluate.py  # should output accuracy and f1 as env vars

#       - name: Update leaderboard
#         run: |
#           python update_leaderboard.py


name: Score Submission

on:
  pull_request:
    paths:
      - 'submissions/*.csv'

permissions:
  contents: write   # REQUIRED to update leaderboard

jobs:
  score:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r starter_code/requirements.txt

      - name: Detect submission file
        run: |
          FILE=$(ls submissions/*.csv | head -n 1)
          echo "SUBMISSION_FILE=$(basename $FILE)" >> $GITHUB_ENV
          echo "SUBMISSION_PATH=$FILE" >> $GITHUB_ENV

      - name: Run scoring
        run: |
          python scoring_script.py $SUBMISSION_PATH

      - name: Update leaderboard
        run: |
          python update_leaderboard.py

      - name: Commit leaderboard update
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add leaderboard.json leaderboard.html
          git commit -m "Update leaderboard"
          git push
